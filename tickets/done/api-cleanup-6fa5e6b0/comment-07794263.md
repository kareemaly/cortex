---
id: 07794263-3874-428e-8188-d819caf9b4d1
author: claude
type: done
created: 2026-02-08T13:43:41.873418Z
---
## Summary

Completed the API cleanup ticket with 4 improvements across 16 files:

### 1. Deduplicate shared types
- Moved 7 response types (HealthResponse, ProjectTicketCounts, ProjectResponse, AddCommentResponse, RequestReviewResponse, ConcludeSessionResponse, ResolvePromptResponse) to `internal/types/response.go`
- Added type aliases in both `api/types.go` and `sdk/client.go` re-export blocks
- Removed 13 duplicate struct definitions from api/ and sdk/ packages

### 2. Centralize hardcoded daemon URL
- Added `DefaultPort = 4200`, `DefaultDaemonURL`, and `DaemonURL()` helper to `internal/daemon/config/config.go`
- Replaced all 4 hardcoded `"http://localhost:4200"` literals across sdk/client.go, hook.go, spawn/config.go, mcp/server.go
- SDK client and hooks now check `CORTEX_DAEMON_URL` env var with fallback
- Updated serve.go flag default to use `config.DefaultPort`

### 3. Consistent HTTP error responses
- Replaced all 8 `http.Error()` calls with `writeError()` in projects.go, handlers.go, events.go for uniform JSON error responses

### 4. Replace stray log.Printf
- Replaced 2 `log.Printf` calls with `h.deps.Logger.Warn` structured logging in tickets.go
- Removed unused `"log"` import

### Merge conflict resolved
- Trivially merged `BindAddress` field from main with `DefaultPort` constant from our branch in daemon/config/config.go
- Fixed `client_test.go` (existed only on main) to use `daemonconfig.DefaultDaemonURL` instead of removed `defaultBaseURL`

### Files changed (16)
internal/types/response.go, internal/daemon/api/types.go, internal/daemon/api/handlers.go, internal/daemon/api/projects.go, internal/daemon/api/prompts.go, internal/daemon/api/events.go, internal/daemon/api/tickets.go, internal/cli/sdk/client.go, internal/cli/sdk/client_test.go, internal/daemon/config/config.go, internal/core/spawn/config.go, internal/core/spawn/spawn_test.go, internal/daemon/mcp/server.go, internal/daemon/mcp/server_test.go, cmd/cortexd/commands/hook.go, cmd/cortexd/commands/serve.go

### Verification
- `make build` ✓
- `make test` ✓
- `make lint` ✓ (0 issues)
- Pre-push hooks passed, pushed to main