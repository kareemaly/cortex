{
  "id": "b791d6b6-0bed-4dae-b502-1f8ffb09e950",
  "type": "work",
  "title": "Ticket TUI: Collapsible Comments and Scroll Preservation",
  "body": "## Summary\n\nTwo UX improvements for the ticket detail TUI:\n\n1. Comments section takes too much space when not selected\n2. Description scroll position resets when agent status updates\n\n## Requirements\n\n### Collapsible Comments Section\n- When comments section (Row 2) is not focused, show only 10-15% height\n- When focused/selected, expand to normal size\n- Smooth transition if possible (or instant is fine)\n- Should still show comment count or preview when collapsed\n\n### Scroll Position Preservation\n- Agent status changes trigger ticket refresh via SSE\n- Currently resets description viewport scroll position\n- Preserve scroll position across refreshes\n- Apply to both description (Row 1) and comments (Row 2) viewports\n\n## Technical Notes\n- SSE updates come through `handleTicketUpdate()` \n- Viewport state likely reset when model rebuilds\n- May need to store scroll offset and restore after update\n\n## Acceptance Criteria\n- [ ] Comments section is compact (10-15%) when not focused\n- [ ] Comments expand when selected/focused\n- [ ] Description scroll position preserved on status updates\n- [ ] Comment list scroll position preserved on status updates",
  "dates": {
    "created": "2026-02-02T14:15:47.375647Z",
    "updated": "2026-02-02T15:49:44.809366Z",
    "progress": "2026-02-02T15:41:40.343782Z",
    "reviewed": "2026-02-02T15:48:56.99507Z",
    "done": "2026-02-02T15:49:44.809366Z"
  },
  "comments": [
    {
      "id": "02c8b9ac-1cd7-4600-9bba-e1feb6238e63",
      "session_id": "7802768f-9a1d-4285-b1e9-7cb8aa2d8749",
      "type": "review_requested",
      "content": "## Summary\n\nImplemented two UX improvements for the ticket detail TUI:\n\n### 1. Scroll Position Preservation (`model.go:207-215`)\n- Saves `bodyViewport.YOffset` before `SetContent()` call\n- Restores the offset after content update instead of calling `GotoTop()`\n- Scroll position now persists across SSE refreshes (new comments, status changes, etc.)\n\n### 2. Collapsible Comments Section (`model.go:1000-1012`)\n- Changed row split from 70/30 to 85/15 when body (Row 1) is focused\n- Comments section now collapses to ~15% when unfocused, providing more space for the ticket body\n- When comments are focused (Tab key), they expand to ~70% as before\n- The existing `commentVisibleRange()` virtual scrolling handles the smaller viewport gracefully\n\n### Files Changed\n- `internal/cli/tui/ticket/model.go`\n\n### Testing\n- All unit tests pass (`make test`)\n- Linter passes (`make lint`)",
      "action": {
        "type": "git_diff",
        "args": {
          "repo_path": "/Users/kareemelbahrawy/projects/cortex1"
        }
      },
      "created_at": "2026-02-02T15:48:56.994074Z"
    },
    {
      "id": "8a5ee768-d3ea-43bf-a807-c5f79d4e7858",
      "session_id": "7802768f-9a1d-4285-b1e9-7cb8aa2d8749",
      "type": "done",
      "content": "## Summary\n\nImplemented two UX improvements for the ticket detail TUI:\n\n### Changes Made\n\n1. **Scroll Position Preservation** (`model.go:207-218`)\n   - Body viewport scroll position is now saved before content refresh\n   - Position is restored after SSE updates instead of resetting to top\n   - Users can now read long ticket descriptions without losing their place\n\n2. **Collapsible Comments Section** (`model.go:997-1012`)\n   - Comments collapse to 15% height when body is focused (was 30%)\n   - Comments expand to 70% when focused via Tab key (unchanged)\n   - Provides more reading space for ticket body by default\n\n### Files Changed\n- `internal/cli/tui/ticket/model.go` - Core logic for both features\n\n### Commit\n- `5bb2933` feat(tui): add collapsible comments and scroll preservation\n\n### Verification\n- All unit tests pass\n- Linter passes with no issues",
      "created_at": "2026-02-02T15:49:44.80658Z"
    }
  ],
  "session": {
    "id": "7802768f-9a1d-4285-b1e9-7cb8aa2d8749",
    "started_at": "2026-02-02T15:41:40.298497Z",
    "ended_at": "2026-02-02T15:49:44.808635Z",
    "agent": "claude",
    "tmux_window": "ticket-tui-collapsible-comments-and-scroll-preserv",
    "current_status": {
      "status": "in_progress",
      "tool": "Bash",
      "work": null,
      "at": "2026-02-02T15:49:38.266746Z"
    },
    "status_history": [
      {
        "status": "starting",
        "tool": null,
        "work": null,
        "at": "2026-02-02T15:41:40.298497Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:41:59.339844Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-02T15:42:01.046129Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-02T15:42:01.177065Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:01.294771Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:01.295892Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:01.322585Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-02T15:42:01.683444Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:01.70826Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:04.080957Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:04.157673Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:04.287394Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:42:04.512057Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:06.532513Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:06.894216Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:08.332772Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:08.653229Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:08.679108Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:08.736115Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:11.107462Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:12.989903Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:13.331659Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:42:13.356883Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:42:15.936732Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:17.456794Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:18.669876Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:19.050287Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:42:19.736057Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:35.026207Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:38.81783Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:42:39.166302Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-02-02T15:42:43.722928Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:46.464935Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:42:46.50006Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:42:53.673982Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:43:00.344969Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:43:00.688447Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:43:03.642633Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:43:07.746781Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:43:13.472844Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:43:16.883445Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-02-02T15:43:42.301912Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:44:15.972294Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-02T15:44:21.938625Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:44:22.076433Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:44:25.776496Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:44:25.777182Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:44:30.770881Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-02T15:44:34.733637Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-02T15:44:38.408799Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:44:41.862687Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-02-02T15:45:24.119872Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:45:31.6185Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:45:31.61928Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:45:31.619791Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:45:37.399885Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:45:37.400625Z"
      },
      {
        "status": "in_progress",
        "tool": "Write",
        "work": null,
        "at": "2026-02-02T15:46:01.04394Z"
      },
      {
        "status": "waiting_permission",
        "tool": null,
        "work": null,
        "at": "2026-02-02T15:46:09.381555Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-02T15:48:01.354887Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-02-02T15:48:09.742821Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-02T15:48:16.184042Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-02-02T15:48:19.695255Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-02T15:48:28.987502Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-02-02T15:48:32.82658Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:48:37.742742Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:48:41.510235Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:48:47.358256Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__requestReview",
        "work": null,
        "at": "2026-02-02T15:48:57.023886Z"
      },
      {
        "status": "idle",
        "tool": null,
        "work": null,
        "at": "2026-02-02T15:49:01.977653Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:49:25.983942Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:49:25.999725Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:49:26.001616Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:49:32.667887Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-02T15:49:38.266746Z"
      }
    ]
  }
}