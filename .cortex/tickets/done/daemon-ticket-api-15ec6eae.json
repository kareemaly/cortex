{
  "id": "15ec6eae-59be-4ad4-891a-85829b2b1d2b",
  "title": "Daemon Ticket API",
  "body": "Add REST API endpoints for ticket and session management.\n\n## Context\n\nThe CLI and TUI communicate with the daemon via HTTP API. MCP is for agents; HTTP is for humans.\n\nSee `DESIGN.md` for:\n- Daemon API endpoints (lines 399-418)\n- Ticket endpoints table (lines 401-411)\n- Session endpoints (lines 415-416)\n\n## Requirements\n\nAdd endpoints to `internal/daemon/api/`:\n\n1. **Ticket Endpoints**\n   - `GET /tickets` - list all tickets (grouped by status)\n   - `GET /tickets/{status}` - list tickets by status\n   - `POST /tickets` - create ticket (returns created ticket)\n   - `GET /tickets/{status}/{id}` - get single ticket\n   - `PUT /tickets/{status}/{id}` - update ticket\n   - `DELETE /tickets/{status}/{id}` - delete ticket\n   - `POST /tickets/{status}/{id}/move` - move to different status\n   - `POST /tickets/{status}/{id}/spawn` - spawn session (stub for now)\n\n2. **Session Endpoints**\n   - `DELETE /sessions/{id}` - kill session\n\n3. **Integration**\n   - Wire endpoints to `internal/ticket` store\n   - Return JSON responses\n   - Proper HTTP status codes (200, 201, 404, 400, etc.)\n\n4. **Server Updates**\n   - Initialize ticket store with project path\n   - Register new routes\n\n## Verification\n\n```bash\nmake build   # Builds successfully\nmake test    # Tests pass\nmake lint    # No lint errors\n\n# Manual testing\ncortexd &\ncurl http://localhost:4200/tickets\ncurl -X POST http://localhost:4200/tickets -d '{\"title\":\"Test\",\"body\":\"Body\"}'\n```\n\n## Notes\n\n- Spawn endpoint is a stub - actual spawning is separate ticket\n- Project path detection needed (find .cortex/ directory)\n- Consider adding query params for filtering (e.g., ?status=backlog)\n\n## Implementation\n\n### Commits Pushed\n- `32ecdc3` feat: add REST API endpoints for ticket and session management\n- `67f366f` Merge branch 'ticket/2026-01-19-daemon-ticket-api'\n\n### Key Files Changed\n- `internal/daemon/api/types.go` - Request/response types (ErrorResponse, CreateTicketRequest, UpdateTicketRequest, MoveTicketRequest, TicketResponse, TicketSummary, ListAllTicketsResponse)\n- `internal/daemon/api/errors.go` - Helper functions (writeJSON, writeError, handleTicketError, validStatus)\n- `internal/daemon/api/tickets.go` - TicketHandlers struct with ListAll, ListByStatus, Create, Get, Update, Delete, Move, Spawn handlers\n- `internal/daemon/api/sessions.go` - SessionHandlers struct with Kill handler (stub)\n- `internal/daemon/api/server.go` - Added ticketStore parameter to NewServer, registered ticket and session routes\n- `cmd/cortexd/commands/serve.go` - Initialize ticket store from ~/.cortex/tickets and pass to NewServer\n\n### Important Decisions\n- Ticket store initialized at `~/.cortex/tickets` (user home directory)\n- Routes verify ticket exists in the specified status before operations\n- Spawn and Kill endpoints return 501 Not Implemented (stubs for future work)\n- Used chi router's nested routing for clean route organization\n\n### Scope Changes\n- None - implemented as specified in the plan",
  "dates": {
    "created": "2026-01-20T13:39:42Z",
    "updated": "2026-01-20T13:39:42Z",
    "done": "2026-01-20T13:39:42Z"
  },
  "comments": [],
  "session": null
}
