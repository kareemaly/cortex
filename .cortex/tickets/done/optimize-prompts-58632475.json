{
  "id": "58632475-980a-41a6-9346-92b2ae010ace",
  "type": "work",
  "title": "Optimize Prompts for Claude Code and Rename Defaults Folder",
  "body": "## Summary\n\nOptimize the default prompts for Claude Code agents and rename the defaults folder from `basic` to `claude-code` to support future agent-specific configurations.\n\n## Requirements\n\n### 1. Rename defaults folder\n- Change `~/.cortex/defaults/basic/` to `~/.cortex/defaults/claude-code/`\n- Update `cortex init` to create `claude-code` folder\n- Update default `extend` path in generated project config\n\n### 2. Architect SYSTEM.md (replaces Claude Code prompt)\n\n```markdown\n# Role\n\nYou are a project architect orchestrating development through tickets and delegation. You do not write code or read source files.\n\n\u003cdo_not_act_before_instructions\u003e\nWhen the user describes work, create a well-scoped ticket and spawn an agent. Only spawn when the user explicitly approves.\n\u003c/do_not_act_before_instructions\u003e\n\n\u003cstay_high_level\u003e\nDo not read source files directly. When you need technical context, spawn an explore agent to investigate and return a summary. Focus on requirements and architecture.\n\u003c/stay_high_level\u003e\n\n\u003cinvestigate_before_answering\u003e\nAlways read ticket details with `readTicket` before making decisions. Never assume ticket state or contents.\n\u003c/investigate_before_answering\u003e\n\n## Cortex Workflow\n\nUse Cortex MCP tools: `listTickets`, `readTicket`, `createTicket`, `updateTicket`, `deleteTicket`, `moveTicket`, `addTicketComment`, `spawnSession`.\n\n### State Transitions\n\nThese happen automatically — do not call `moveTicket` for them:\n- `spawnSession` → ticket moves to **progress**\n- Agent concludes after approval → ticket moves to **done**\n\nUse `moveTicket` only for manual corrections (e.g., returning a ticket to backlog).\n\n### After Spawning\n\n1. Agent works autonomously on the ticket\n2. Agent calls `requestReview` → ticket moves to **review**\n3. **User** reviews and approves directly (you do not have an approval tool)\n4. Agent concludes → ticket moves to **done**\n\n## Context Awareness\n\nYour context will compact as it fills. Persist important decisions in ticket comments (type: decision) so state survives compaction.\n\n## Communication\n\nBe direct and concise. Provide fact-based assessments. Do not give time estimates.\n```\n\n### 3. Ticket SYSTEM.md (appended to Claude Code prompt — minimal)\n\n```markdown\n## Cortex Workflow\n\nUse Cortex MCP tools: `readTicket`, `addComment`, `addBlocker`, `requestReview`, `concludeSession`.\n\n1. Understand the ticket provided below\n2. Ask clarifying questions if requirements are unclear\n3. Implement the changes\n4. Call `requestReview` with a summary and wait for user instructions\n```\n\n### 4. Ticket APPROVE.md\n\n```markdown\n## Approved\n\n1. Commit your changes\n2. Push to origin\n3. Call `concludeSession` with a summary of what was done\n```\n\n### 5. KICKOFF prompts (unchanged)\n\nKeep existing templates as-is:\n- `architect/KICKOFF.md`\n- `ticket/work/KICKOFF.md`\n\n## Acceptance Criteria\n\n- [ ] Defaults folder renamed from `basic` to `claude-code`\n- [ ] `cortex init` creates `~/.cortex/defaults/claude-code/`\n- [ ] Generated project config uses `extend: ~/.cortex/defaults/claude-code`\n- [ ] Architect SYSTEM.md updated with optimized prompt\n- [ ] Ticket SYSTEM.md updated with minimal Cortex-only workflow\n- [ ] Ticket APPROVE.md updated with 3-step conclusion\n- [ ] KICKOFF prompts unchanged",
  "dates": {
    "created": "2026-01-29T11:32:03.767382Z",
    "updated": "2026-01-29T12:40:38.285569Z",
    "progress": "2026-01-29T11:33:26.557833Z",
    "reviewed": "2026-01-29T11:40:23.072685Z",
    "done": "2026-01-29T12:40:38.285569Z"
  },
  "comments": [
    {
      "id": "5cfa9303-1adf-45d0-9dbf-2e12ac124306",
      "session_id": "d4288c15-42a5-4c1c-a7e4-62760a09512c",
      "type": "review_requested",
      "content": "## Summary\n\nOptimized embedded prompts for Claude Code agents and renamed the defaults folder from `basic` to `claude-code`.\n\n### Changes Made\n\n**1. Folder rename (basic → claude-code)**\n- `setupBasicDefaults()` → `setupClaudeCodeDefaults()` \n- Updated all references in comments and config values\n- `extend: ~/.cortex/defaults/basic` → `extend: ~/.cortex/defaults/claude-code`\n\n**2. Architect SYSTEM.md (94 → 46 lines)**\n- Condensed role description to single sentence\n- Shortened XML behavioral tags\n- Simplified to single tools list instead of read/write categories\n- Added \"State Transitions\" section explaining auto-moves\n- Added \"After Spawning\" section with 4-step workflow\n- Removed \"Writing Good Tickets\" section\n- Removed \"Communication Style\" (kept minimal version)\n\n**3. Ticket SYSTEM.md (39 → 10 lines)**\n- Reduced to 4-tool list: `readTicket`, `addComment`, `addBlocker`, `requestReview`, `concludeSession`\n- Simplified to 4-step workflow\n- Removed detailed comments documentation\n- Removed context awareness section (duplicates what Claude Code already knows)\n\n**4. Ticket APPROVE.md (28 → 5 lines)**\n- Reduced to 3 simple steps: commit, push, conclude\n- Removed worktree conditionals\n- Removed verbose instructions\n\n### Files Modified\n\n- `internal/install/install.go` - Folder rename + architect system prompt\n- `internal/install/prompts.go` - Ticket system prompt + approve prompt\n\n### Verification\n\n- `make build` - Passed\n- `make lint` - Passed (0 issues)\n- `make test` - All tests pass",
      "action": {
        "type": "git_diff",
        "args": {
          "commit": "1281434",
          "repo_path": "/Users/kareemelbahrawy/projects/cortex1"
        }
      },
      "created_at": "2026-01-29T11:40:23.071742Z"
    },
    {
      "id": "18e289b7-a6a5-4d2b-8cfc-bb906c49faff",
      "session_id": "d4288c15-42a5-4c1c-a7e4-62760a09512c",
      "type": "done",
      "content": "## Summary\n\nOptimized embedded prompts for Claude Code agents and renamed the defaults folder from `basic` to `claude-code` to support future agent-specific configurations.\n\n## Changes Made\n\n### 1. Folder Rename (basic → claude-code)\n- Renamed `setupBasicDefaults()` to `setupClaudeCodeDefaults()`\n- Updated all path references from `~/.cortex/defaults/basic` to `~/.cortex/defaults/claude-code`\n- Updated comments and config templates to reference new folder name\n\n### 2. Architect SYSTEM.md Optimization\nReduced from 94 to 46 lines:\n- Condensed role description to single sentence\n- Shortened XML behavioral tags to essential guidance\n- Replaced read/write tool categories with single inline tools list\n- Added \"State Transitions\" section explaining automatic ticket moves\n- Added \"After Spawning\" section with 4-step workflow clarification\n- Removed \"Writing Good Tickets\" section (redundant)\n- Kept minimal \"Communication\" section\n\n### 3. Ticket SYSTEM.md Optimization\nReduced from 39 to 10 lines:\n- Simplified to 5-tool list: `readTicket`, `addComment`, `addBlocker`, `requestReview`, `concludeSession`\n- Reduced to 4-step workflow\n- Removed detailed comments documentation (agent already knows)\n- Removed context awareness section (duplicates Claude Code knowledge)\n\n### 4. Ticket APPROVE.md Optimization\nReduced from 28 to 5 lines:\n- Simplified to 3 steps: commit, push, conclude\n- Removed worktree conditionals\n- Removed verbose step-by-step instructions\n\n## Files Modified\n\n- `internal/install/install.go` - Folder rename + architect system prompt\n- `internal/install/prompts.go` - Ticket system + approve prompts\n\n## Rationale\n\nThe original prompts were written for a generic agent and included redundant information that Claude Code already knows. The optimized prompts are minimal, focusing only on Cortex-specific workflow while relying on Claude Code's built-in capabilities.\n\n## Verification\n\n- `make build` - Passed\n- `make lint` - Passed (0 issues)\n- `make test` - All tests pass\n\n## Follow-up Notes\n\nWhen `cortex init` is run, it will create `~/.cortex/defaults/claude-code/` instead of `basic/`. Existing installations with `basic/` will continue to work but won't receive the optimized prompts unless the user deletes the old folder and re-runs init with `--force`.",
      "created_at": "2026-01-29T12:40:38.283585Z"
    }
  ],
  "session": {
    "id": "d4288c15-42a5-4c1c-a7e4-62760a09512c",
    "started_at": "2026-01-29T11:33:26.516541Z",
    "ended_at": "2026-01-29T12:40:38.28485Z",
    "agent": "claude",
    "tmux_window": "optimize-prompts-for-claude-code-and-rename-defaul",
    "current_status": {
      "status": "in_progress",
      "tool": "Bash",
      "work": null,
      "at": "2026-01-29T12:40:27.326896Z"
    },
    "status_history": [
      {
        "status": "starting",
        "tool": null,
        "work": null,
        "at": "2026-01-29T11:33:26.516541Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__readTicket",
        "work": null,
        "at": "2026-01-29T11:33:45.024624Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-01-29T11:33:48.701035Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-01-29T11:33:48.841578Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-01-29T11:33:48.981316Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:33:49.650304Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:33:52.882433Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:33:52.883472Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-01-29T11:33:53.256783Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:33:56.46771Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:33:56.46841Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:33:56.46978Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:00.557301Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:00.558208Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:00.558732Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:00.559171Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:34:04.430746Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-01-29T11:34:04.703016Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:07.570187Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-01-29T11:34:07.917322Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:10.355906Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:10.356807Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:34:13.370612Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:16.358937Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:19.965732Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:34:23.078019Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:25.579351Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:34:28.611247Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:34:30.845133Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:33.637437Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:34:36.974887Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:38.787197Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:41.5886Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:34:44.071542Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-01-29T11:35:12.271986Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:35:23.253203Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:35:23.253984Z"
      },
      {
        "status": "in_progress",
        "tool": "Write",
        "work": null,
        "at": "2026-01-29T11:35:54.844911Z"
      },
      {
        "status": "waiting_permission",
        "tool": null,
        "work": null,
        "at": "2026-01-29T11:36:01.935182Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__readTicket",
        "work": null,
        "at": "2026-01-29T11:37:41.250949Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:37:41.302376Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-01-29T11:37:41.303418Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:37:48.740909Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:37:55.610365Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:38:00.315339Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:38:05.122874Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:38:09.042323Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:38:13.744375Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:38:18.380011Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:38:52.237509Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:38:56.958688Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:39:10.492468Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:39:15.122114Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-01-29T11:39:25.108037Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:39:29.71647Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:39:38.072437Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:39:51.15898Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:39:51.666742Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:39:55.823538Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:40:01.520937Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:40:05.047951Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:40:05.090343Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T11:40:11.662943Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__requestReview",
        "work": null,
        "at": "2026-01-29T11:40:23.119419Z"
      },
      {
        "status": "in_progress",
        "tool": "TodoWrite",
        "work": null,
        "at": "2026-01-29T11:40:29.396999Z"
      },
      {
        "status": "idle",
        "tool": null,
        "work": null,
        "at": "2026-01-29T11:40:34.577176Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T12:40:20.415971Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-01-29T12:40:27.326896Z"
      }
    ]
  }
}