{
  "id": "ffbd0b31-2648-4683-8e97-b04c05115e94",
  "title": "HTTP API Spawn Endpoints",
  "body": "Add spawn endpoints for architect and update ticket spawn to support mode parameter.\n\n## Context\n\nThis is a fresh project with no users. No backward compatibility needed. Breaking changes are fine. Do not accumulate tech debt.\n\n## Dependencies\n\nRequires `2026-01-22-architect-session-state.md` to be completed first.\n\n## Endpoints\n\n### Architect\n\n```\nPOST /architect/spawn\n  Query params: mode=normal|resume|fresh (default: normal)\n  Response: { session_id, tmux_session, tmux_window, state }\n\nGET /architect\n  Response: { session?, state } (state: normal/active/orphaned/ended)\n```\n\n### Ticket Spawn (update existing)\n\n```\nPOST /tickets/{status}/{id}/spawn\n  Query params: mode=normal|resume|fresh (default: normal)\n  Response: { session, ticket, state }\n```\n\n## Behavior\n\n| State | mode=normal | mode=resume | mode=fresh |\n|-------|-------------|-------------|------------|\n| Normal | spawn new | error | error |\n| Active | return existing, focus window | error | error |\n| Orphaned | error | resume session | clear & spawn new |\n| Ended | spawn new | error | spawn new |\n\n## Implementation\n\n- Use `internal/core/spawn/` package for all spawn operations\n- Use `internal/project/architect/` for architect state\n- CLI will call these endpoints via SDK\n\n## Verification\n\n```bash\nmake lint\nmake test\nmake build\nmake test-integration\n```\n\n## Implementation\n\n### Commits\n\n- `ed2b9dc` feat: add HTTP API architect spawn endpoints with mode parameter support\n\n### Key Files Changed\n\n- **`internal/daemon/api/architect.go`** (new) - `ArchitectHandlers` with `GetState` and `Spawn` handlers\n- **`internal/daemon/api/types.go`** - Added `ArchitectStateResponse`, `ArchitectSessionResponse`, `ArchitectSpawnResponse`\n- **`internal/daemon/api/server.go`** - Added `/architect` route group\n- **`internal/daemon/api/tickets.go`** - Updated `Spawn` handler with mode parameter and state detection; removed unused `writeMCPConfig` and `buildAgentCommand` functions\n\n### Decisions\n\n- For Active+normal mode, the handler returns 200 OK (not 201) with the existing session and focuses the tmux window\n- Ticket spawn now uses the `spawn.Spawner` from `internal/core/spawn/` for consistency with architect spawn\n- Removed legacy MCP config generation code from tickets.go since spawner handles this internally",
  "dates": {
    "created": "2026-01-23T06:42:25Z",
    "updated": "2026-01-23T06:42:25Z",
    "done": "2026-01-23T06:42:25Z"
  },
  "comments": [],
  "session": null
}
