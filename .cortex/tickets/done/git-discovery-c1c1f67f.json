{
  "id": "c1c1f67f-840f-49ca-bb45-b18872adf00c",
  "title": "Git Discovery",
  "body": "Implement git repository discovery and status tracking for tickets.\n\n## Context\n\nTickets track git state via `git_base` (commit SHA when session started) and sessions report file changes. Projects can have multiple repos (monorepo support).\n\nSee `DESIGN.md` for:\n- Git base tracking in session schema (lines 102-104, 121-123)\n- Project config git.repos (lines 279-282)\n- Session view showing git diff stats (lines 339-342)\n\n## Requirements\n\nCreate `internal/git/` package that:\n\n1. **Repository Discovery**\n   - Find .git directories from project config paths\n   - Support multiple repos per project\n   - Handle nested repos (monorepo)\n\n2. **State Queries**\n   - Get current branch name\n   - Get current commit SHA (short and full)\n   - Check if repo is clean (no uncommitted changes)\n\n3. **Diff Operations**\n   - Get diff stats since a base commit (files changed, insertions, deletions)\n   - List changed files since base commit\n   - Support comparing across branches\n\n4. **Utilities**\n   - Validate path contains git repo\n   - Get repo root from any subdirectory\n\n## Verification\n\n```bash\nmake build   # Builds successfully\nmake test    # Tests pass\nmake lint    # No lint errors\n```\n\n## Notes\n\n- Use `os/exec` to shell out to git commands\n- Handle cases where git isn't installed gracefully\n- Parse git output carefully (porcelain formats where available)\n- Tests can use temporary git repos created in test setup\n\n## Implementation\n\n### Commits\n\n- `4dde860` feat: add git discovery package for repository detection and status\n- `069c29e` Merge branch 'ticket/2026-01-19-git-discovery'\n\n### Key Files\n\n| File | Description |\n|------|-------------|\n| `internal/git/errors.go` | Custom error types with helper functions |\n| `internal/git/git.go` | Core `Repo` type, discovery functions, git command helpers |\n| `internal/git/status.go` | State queries (branch, commit, clean status) |\n| `internal/git/diff.go` | Diff stats and changed file operations |\n| `internal/git/git_test.go` | Unit tests for all public functions |\n| `internal/git/testutil_test.go` | Test helpers for creating temp git repos |\n\n### Decisions\n\n- Used `exec.Command` to shell out to git rather than a Go git library for simplicity and reliability\n- Added `DiscoverRepos` with deduplication to support projects with multiple repos\n- Created typed errors (`GitNotInstalledError`, `NotARepoError`, `CommitNotFoundError`) with helper functions (`IsNotARepo()`, etc.) following existing codebase patterns\n- Tests use temporary git repos with full commit history for realistic testing\n\n### Scope\n\nImplemented as specified. No scope changes from original ticket.",
  "dates": {
    "created": "2026-01-20T13:07:38Z",
    "updated": "2026-01-20T13:07:38Z",
    "done": "2026-01-20T13:07:38Z"
  },
  "comments": [],
  "session": null
}
