{
  "id": "96ce2773-4ab7-425a-b512-7c8425995435",
  "title": "Architect Session State",
  "body": "Create file-based state management for architect sessions, similar to ticket sessions.\n\n## Context\n\nThis is a fresh project with no users. No backward compatibility needed. Breaking changes are fine. Do not accumulate tech debt.\n\n## State File\n\nLocation: `.cortex/architect.json`\n\n```json\n{\n  \"id\": \"uuid\",\n  \"tmux_session\": \"cortex-projectname\",\n  \"tmux_window\": \"architect\",\n  \"started_at\": \"2026-01-22T...\",\n  \"ended_at\": null\n}\n```\n\nNote: `id` will be used as Claude's session ID for resume support (`claude --session-id`).\n\n## Package Location\n\n`internal/project/architect/` (or integrate into existing `internal/project/`)\n\n## Functions Needed\n\n- `Load(projectPath) \u2192 *ArchitectSession, error` - load state file, nil if not exists\n- `Save(projectPath, session) \u2192 error` - write state file\n- `Clear(projectPath) \u2192 error` - remove state file\n\n## State Detection\n\nIntegrate with `internal/core/spawn/state.go` to detect architect session state:\n- `Normal` - no state file or ended_at is set\n- `Active` - state file exists, ended_at nil, tmux window exists\n- `Orphaned` - state file exists, ended_at nil, tmux window gone\n- `Ended` - state file exists, ended_at set\n\n## Used By\n\n- `internal/core/spawn/` - for architect spawning\n- `internal/daemon/api/` - architect endpoints (future)\n- `internal/daemon/mcp/` - architect tools (future)\n\n## Verification\n\n```bash\nmake lint\nmake test\nmake build\nmake test-integration\n```\n\n## Implementation\n\n### Commits Pushed\n\n- `67ec3e3` feat: add architect session state management with spawn state detection\n\n### Key Files Changed\n\n**Created:**\n- `internal/project/architect/session.go` - Session struct with Load/Save/Clear functions\n- `internal/project/architect/session_test.go` - 10 test cases for session management\n\n**Modified:**\n- `internal/core/spawn/state.go` - Added ArchitectStateInfo and DetectArchitectState\n- `internal/core/spawn/spawn_test.go` - Added 7 architect state tests\n\n### Important Decisions\n\n- Used same state detection pattern as ticket sessions (Normal, Active, Orphaned, Ended)\n- ArchitectStateInfo.CanResume() checks both Session != nil and Session.ID != \"\" (unlike ticket which uses ClaudeSessionID field)\n- State file stored at `.cortex/architect.json` as specified\n- Clear() is idempotent (no error if file doesn't exist)\n\n### Scope Changes\n\nNone - implemented exactly as specified in the plan.",
  "dates": {
    "created": "2026-01-22T13:19:48Z",
    "updated": "2026-01-22T13:19:48Z",
    "done": "2026-01-22T13:19:48Z"
  },
  "comments": [],
  "session": null
}
