{
  "id": "b657b748-6a79-4418-9922-99753bd5b4a8",
  "title": "Fix Broken Spawn: Tmux Session Target Prefix-Matching Bug",
  "body": "## Problem\n\nSpawning a ticket session creates the tmux window in the WRONG session (the daemon's session \"Main\" instead of the project's \"cortex\" session), causing cascading failures:\n\n1. **Wrong tmux session** — Window created in \"Main\" instead of \"cortex\"\n2. **send-keys fails** — `send-keys -t cortex:1` fails because window 1 doesn't exist in \"cortex\"\n3. **No split panes** — Everything after window creation fails\n\nError: `\"spawn: failed to spawn agent in tmux: tmux command failed: send-keys: can't find window: 1\"`\n\n## Root Cause\n\n`CreateWindow` in `internal/tmux/window.go` uses `new-window -a -t session` where `-t` takes a `target-window`. Tmux's target-window resolution checks **window name prefix matches in the current session BEFORE checking session names**.\n\nThe daemon process runs in the \"Main\" tmux session which has a window named \"cortexd\". When it targets `-t cortex`:\n1. Tmux checks window names in current session (Main) → \"cortex\" prefix-matches \"cortexd\" → targets Main:cortexd\n2. Never reaches session name check for \"cortex\" session\n\n**Fix:** Use `-t cortex:` (trailing colon) which forces session-level resolution, bypassing window name matching.\n\nVerified:\n- `TMUX_PANE=%518 tmux new-window -a -t cortex ...` → `Main:1` (BUG)\n- `TMUX_PANE=%518 tmux new-window -a -t cortex: ...` → `cortex:1` (FIXED)\n\n## Fix Applied\n\nChanged `CreateWindow` in `internal/tmux/window.go` to format session target as `fmt.Sprintf(\"%s:\", session)`.\n\n## Remaining Scope\n\n- [x] Fix tmux session targeting in `CreateWindow`\n- [ ] Rebuild daemon and verify spawn works\n- [ ] Clean up worktree issue (separate from this fix — worktrees temporarily disabled)\n- [ ] `make build \u0026\u0026 make test` pass",
  "dates": {
    "created": "2026-01-27T10:49:04.741856Z",
    "updated": "2026-01-27T10:57:50.298353Z",
    "done": "2026-01-27T10:57:50.298353Z"
  },
  "comments": [],
  "session": {
    "id": "6ece1ba9-563c-4e00-8cc9-0fb8a936c0a1",
    "started_at": "2026-01-27T10:49:18.743817Z",
    "ended_at": "2026-01-27T10:49:18.761164Z",
    "agent": "claude",
    "tmux_window": "fix-broken-spawn-worktree-path-wrong-tmux-session-",
    "current_status": {
      "status": "starting",
      "tool": null,
      "work": null,
      "at": "2026-01-27T10:49:18.743817Z"
    },
    "status_history": [
      {
        "status": "starting",
        "tool": null,
        "work": null,
        "at": "2026-01-27T10:49:18.743817Z"
      }
    ]
  }
}