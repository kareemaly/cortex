{
  "id": "3ea312e1-5b44-4ced-8d90-1ad2f4003491",
  "title": "Lifecycle Hooks",
  "body": "Implement the lifecycle hook execution framework.\n\n## Context\n\nHooks are shell commands that run at key points in the ticket lifecycle. They're defined in `.cortex/cortex.yaml` and executed by MCP tools.\n\nSee `DESIGN.md` for:\n- Lifecycle hooks config (lines 228-260)\n- Hook behavior (lines 255-259)\n- Template variables (lines 263-269)\n- Hook response format (lines 206-226)\n\n## Requirements\n\nCreate `internal/lifecycle/` package that:\n\n1. **Hook Types**\n   - `on_pickup` - runs when agent starts work\n   - `on_submit` - runs when agent submits report\n   - `on_approve` - runs when ticket is approved\n\n2. **Execution**\n   - Run shell commands sequentially\n   - Capture stdout for each command\n   - Stop on first non-zero exit code\n   - Return structured result (success, hook outputs, exit codes)\n\n3. **Template Variables**\n   - `{{ticket_id}}` - ticket UUID\n   - `{{ticket_slug}}` - slugified title\n   - `{{ticket_title}}` - full title\n   - `{{commit_message}}` - only for on_approve\n\n4. **Interface**\n   - Accept hook definitions and template values\n   - Return results per DESIGN.md hook response format\n   - No config loading - that's the project-config ticket's job\n\n## Verification\n\n```bash\nmake build   # Builds successfully\nmake test    # Tests pass\nmake lint    # No lint errors\n```\n\n## Notes\n\n- This package executes hooks, doesn't load config\n- MCP integration is a separate ticket\n- Commands run in project directory context\n- Handle missing commands gracefully\n\n## Implementation\n\n### Commits\n- `e7ec3a9` feat: add lifecycle hooks package for shell command execution at ticket lifecycle points\n\n### Key Files Changed\n- `internal/lifecycle/errors.go` - Error types (ExecutionError, TemplateError, InvalidVariableError) with Is* helpers\n- `internal/lifecycle/hooks.go` - Core types (Executor, HookDefinition, ExecutionResult, TemplateVars) and CommandRunner interface\n- `internal/lifecycle/template.go` - Template variable expansion using regex, validation for hook-specific variables\n- `internal/lifecycle/hooks_test.go` - 20 test functions with mock runner for comprehensive coverage\n\n### Key Decisions\n- Used `sh -c` for command execution to support shell features (pipes, redirects)\n- CommandRunner interface allows mock injection for testing without actual shell execution\n- Unknown template variables are left unchanged (graceful degradation) rather than erroring\n- Follows error pattern from `internal/git/errors.go` for consistency\n- Template validation ensures `{{commit_message}}` only used in `on_approve` hooks\n\n### Scope\nNo changes from original ticket scope",
  "dates": {
    "created": "2026-01-20T13:39:07Z",
    "updated": "2026-01-20T13:39:07Z",
    "done": "2026-01-20T13:39:07Z"
  },
  "comments": [],
  "session": null
}
