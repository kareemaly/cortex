{
  "id": "7e4b3b3e-d235-4398-954f-1099a6ed532b",
  "title": "CLI Skeleton",
  "body": "Set up the cortex CLI with Cobra commands and HTTP client for daemon communication.\n\n## Context\n\nThe project foundation is complete. Now we need a CLI that can issue commands and communicate with the daemon.\n\nReference `~/projects/cortex/cmd/cortex0/` for patterns, but simplify per DESIGN.md.\n\n## Requirements\n\n### 1. Dependencies\n\nAdd to go.mod:\n```\ngithub.com/spf13/cobra\n```\n\n### 2. cmd/cortex/main.go\n\nExpand to Cobra root command:\n\n```go\npackage main\n\nimport (\n\t\"os\"\n\n\t\"github.com/kareemaly/cortex1/cmd/cortex/commands\"\n)\n\nfunc main() {\n\tif err := commands.Execute(); err != nil {\n\t\tos.Exit(1)\n\t}\n}\n```\n\n### 3. cmd/cortex/commands/root.go\n\nRoot command setup:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\t\"os\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar rootCmd = &cobra.Command{\n\tUse:   \"cortex\",\n\tShort: \"Orchestration layer for AI coding workflows\",\n\tLong: `Cortex is an orchestration layer for AI coding workflows.\nIt provides file-based ticket management with MCP tools for agent interaction.`,\n\t// Default action: show help\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tcmd.Help()\n\t},\n}\n\nfunc Execute() error {\n\treturn rootCmd.Execute()\n}\n\nfunc init() {\n\t// Global flags can be added here\n\t// rootCmd.PersistentFlags().StringVar(&cfgFile, \"config\", \"\", \"config file\")\n}\n```\n\n### 4. cmd/cortex/commands/version.go\n\nVersion command:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n\t\"github.com/kareemaly/cortex1/pkg/version\"\n)\n\nvar versionCmd = &cobra.Command{\n\tUse:   \"version\",\n\tShort: \"Print version information\",\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tinfo := version.Get()\n\t\tfmt.Printf(\"cortex %s\\n\", info.Version)\n\t\tfmt.Printf(\"  commit:  %s\\n\", info.Commit)\n\t\tfmt.Printf(\"  built:   %s\\n\", info.BuildDate)\n\t\tfmt.Printf(\"  go:      %s\\n\", info.GoVersion)\n\t\tfmt.Printf(\"  platform: %s\\n\", info.Platform)\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(versionCmd)\n}\n```\n\n### 5. cmd/cortex/commands/kanban.go\n\nKanban command stub:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar kanbanCmd = &cobra.Command{\n\tUse:   \"kanban\",\n\tShort: \"Open kanban TUI for current project\",\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Println(\"kanban: not implemented yet\")\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(kanbanCmd)\n}\n```\n\n### 6. cmd/cortex/commands/architect.go\n\nArchitect command stub:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar architectCmd = &cobra.Command{\n\tUse:   \"architect\",\n\tShort: \"Start or attach to architect session\",\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Println(\"architect: not implemented yet\")\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(architectCmd)\n}\n```\n\n### 7. cmd/cortex/commands/spawn.go\n\nSpawn command stub:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar spawnCmd = &cobra.Command{\n\tUse:   \"spawn <ticket-id>\",\n\tShort: \"Spawn a ticket session\",\n\tArgs:  cobra.ExactArgs(1),\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Printf(\"spawn: not implemented yet (ticket: %s)\\n\", args[0])\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(spawnCmd)\n}\n```\n\n### 8. cmd/cortex/commands/list.go\n\nList command stub:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar listCmd = &cobra.Command{\n\tUse:   \"list\",\n\tShort: \"List tickets\",\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tstatus, _ := cmd.Flags().GetString(\"status\")\n\t\tif status != \"\" {\n\t\t\tfmt.Printf(\"list: not implemented yet (status: %s)\\n\", status)\n\t\t} else {\n\t\t\tfmt.Println(\"list: not implemented yet\")\n\t\t}\n\t},\n}\n\nfunc init() {\n\tlistCmd.Flags().String(\"status\", \"\", \"Filter by status (backlog, progress, done)\")\n\trootCmd.AddCommand(listCmd)\n}\n```\n\n### 9. cmd/cortex/commands/session.go\n\nSession command stub:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar sessionCmd = &cobra.Command{\n\tUse:   \"session <id>\",\n\tShort: \"Open session view TUI\",\n\tArgs:  cobra.ExactArgs(1),\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Printf(\"session: not implemented yet (id: %s)\\n\", args[0])\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(sessionCmd)\n}\n```\n\n### 10. cmd/cortex/commands/install.go\n\nInstall command stub:\n\n```go\npackage commands\n\nimport (\n\t\"fmt\"\n\n\t\"github.com/spf13/cobra\"\n)\n\nvar installCmd = &cobra.Command{\n\tUse:   \"install\",\n\tShort: \"Run initial setup\",\n\tRun: func(cmd *cobra.Command, args []string) {\n\t\tfmt.Println(\"install: not implemented yet\")\n\t},\n}\n\nfunc init() {\n\trootCmd.AddCommand(installCmd)\n}\n```\n\n### 11. internal/cli/sdk/client.go\n\nHTTP client for daemon API:\n\n```go\npackage sdk\n\nimport (\n\t\"encoding/json\"\n\t\"fmt\"\n\t\"net/http\"\n\t\"time\"\n)\n\ntype Client struct {\n\tbaseURL    string\n\thttpClient *http.Client\n}\n\nfunc NewClient(baseURL string) *Client {\n\treturn &Client{\n\t\tbaseURL: baseURL,\n\t\thttpClient: &http.Client{\n\t\t\tTimeout: 30 * time.Second,\n\t\t},\n\t}\n}\n\nfunc DefaultClient() *Client {\n\treturn NewClient(\"http://localhost:4200\")\n}\n\ntype HealthResponse struct {\n\tStatus  string `json:\"status\"`\n\tVersion string `json:\"version\"`\n}\n\nfunc (c *Client) Health() (*HealthResponse, error) {\n\tresp, err := c.httpClient.Get(c.baseURL + \"/health\")\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"request failed: %w\", err)\n\t}\n\tdefer resp.Body.Close()\n\n\tif resp.StatusCode != http.StatusOK {\n\t\treturn nil, fmt.Errorf(\"unexpected status: %d\", resp.StatusCode)\n\t}\n\n\tvar health HealthResponse\n\tif err := json.NewDecoder(resp.Body).Decode(&health); err != nil {\n\t\treturn nil, fmt.Errorf(\"decode failed: %w\", err)\n\t}\n\n\treturn &health, nil\n}\n```\n\n### 12. Remove .gitkeep files\n\nDelete these files as they're replaced by real code:\n- `internal/cli/sdk/.gitkeep`\n\nKeep `internal/cli/tui/.gitkeep` (TUI ticket will handle it).\n\n## Verification\n\n```bash\n# Build succeeds\nmake build\n\n# Help shows all commands\n./bin/cortex\n# Should show: kanban, architect, spawn, list, session, version, install\n\n# Version works\n./bin/cortex version\n# Should show version details\n\n# Subcommands exist\n./bin/cortex kanban\n./bin/cortex architect\n./bin/cortex spawn test-123\n./bin/cortex list --status=backlog\n./bin/cortex session test-456\n./bin/cortex install\n# All should print \"not implemented yet\"\n\n# Lint passes\nmake lint\n```\n\n## Notes\n\n- Commands are stubs - they print messages but don't do real work\n- SDK client only has Health() for now - more methods added as needed\n- No TUI yet - that's a separate ticket\n- Global flags (like --config) can be added to root.go later\n\n## Implementation\n\n### Commits\n- `803038b` feat: add CLI skeleton with Cobra commands and SDK client\n\n### Key Files Changed\n- `cmd/cortex/main.go` - Updated to use Cobra commands\n- `cmd/cortex/commands/*.go` - New command files (root, version, kanban, architect, spawn, list, session, install)\n- `pkg/version/version.go` - Added `Info` struct and `Get()` function for structured version info\n- `internal/cli/sdk/client.go` - HTTP client with `Health()` method for daemon communication\n- `go.mod` / `go.sum` - Added spf13/cobra dependency\n\n### Decisions\n- Simplified SDK client to return `error` from `Health()` instead of `*HealthResponse` (simpler API, response parsing can be added when needed)\n- Used `defer func() { _ = resp.Body.Close() }()` pattern to satisfy errcheck linter\n- Stub messages use format \"not implemented yet\" without command prefix (cleaner output)\n- Root command shows help by default via Cobra's built-in behavior (no explicit Run function needed)\n\n### Scope Changes\n- None - implemented as specified",
  "dates": {
    "created": "2026-01-19T13:47:31Z",
    "updated": "2026-01-19T13:47:31Z",
    "done": "2026-01-19T13:47:31Z"
  },
  "comments": [],
  "session": null
}
