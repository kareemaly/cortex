{
  "id": "7c1fd326-46fc-4a0a-83b8-f35825251bd4",
  "title": "Prompt Restructure",
  "body": "## Context\n\nEarly development, no users. Breaking changes are fine. Do not accumulate tech debt.\n\n## Problem\n\nCurrent prompts mix dynamic content with static instructions. Need cleaner separation using `--append-system-prompt`.\n\n## Requirements\n\n### Ticket Agent\n\n**Prompt (hardcoded in code):**\n```\n# Ticket: {{.Title}}\n\n{{.Body}}\n```\n\n**System prompt:** `--append-system-prompt .cortex/prompts/ticket-agent.md`\n\n### Architect\n\n**Prompt (hardcoded in code, queries daemon API at spawn):**\n```\n# Tickets\n\n## Backlog\n- [title] (updated: 2026-01-24)\n...\n\n## In Progress\n...\n\n## Review\n...\n\n## Done (recent 5)\n...\n```\n\n**System prompt:** `--append-system-prompt .cortex/prompts/architect.md`\n\n### Prompt Files\n\nMust be installed via `cortex init`. Error if missing.\n\nUpdate tool names to fully qualified format:\n- `mcp__cortex__createTicket`\n- `mcp__cortex__readTicket`\n- `mcp__cortex__listTickets`\n- `mcp__cortex__updateTicket`\n- `mcp__cortex__deleteTicket`\n- `mcp__cortex__moveTicket`\n- `mcp__cortex__spawnSession`\n- `mcp__cortex__pickupTicket`\n- `mcp__cortex__submitReport`\n- `mcp__cortex__approve`\n\n### Cleanup\n\n- Remove template rendering from prompt loading\n- Remove default prompts from code\n\n## Implementation\n\n### Commits\n\n- `624d4f7` feat: separate dynamic content from static prompt instructions via --append-system-prompt\n- `ba5fae9` fix: pass file content to --append-system-prompt instead of path\n\n### Key Files Changed\n\n- `internal/core/spawn/command.go` - Added `AppendSystemPrompt` field (now passes content not path), escapes content for shell\n- `internal/core/spawn/spawn.go` - New `buildPrompt()` logic that queries daemon API for architect, builds dynamic content, loads prompt file content\n- `internal/prompt/prompt.go` - Removed template rendering, kept path helpers, added `ValidatePromptFile()` and `LoadPromptFile()`\n- `internal/prompt/errors.go` - Removed `ParseError` and `RenderError`, kept `NotFoundError`\n- `internal/install/install.go` - Added default prompts as local constants with qualified MCP tool names\n\n### Key Decisions\n\n- Moved slug generation inline in `command.go` to avoid circular dependency with ticket package\n- Architect prompt includes project name header followed by ticket list grouped by status\n- Ticket agent prompt is minimal: just title and body (static instructions come from file)\n- Default prompts use fully qualified MCP tool names (e.g., `mcp__cortex__listTickets`)\n- `--append-system-prompt` receives file content (not path) - content is escaped for shell using POSIX single-quote escaping\n\n### Scope Changes\n\n- Added project name to architect dynamic prompt (not in original spec but requested during implementation)",
  "dates": {
    "created": "2026-01-24T10:37:13Z",
    "updated": "2026-01-24T10:37:13Z",
    "done": "2026-01-24T10:37:13Z"
  },
  "comments": [],
  "session": null
}
