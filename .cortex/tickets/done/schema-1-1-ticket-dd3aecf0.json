{
  "id": "dd3aecf0-95cf-4c3d-9291-a470fffda5bb",
  "title": "Schema: 1-1 Ticket-Session Relationship",
  "body": "Change ticket-session relationship from one-to-many to one-to-one, and add Claude session ID for resume support.\n\n## Schema Changes\n\n### Ticket\n```go\n// Before\nSessions []Session\n\n// After\nSession *Session  // nil if no session\n```\n\n### Session\nAdd field:\n```go\nClaudeSessionID string  // UUID we generate and pass to claude --session-id\n```\n\n### Store Methods\n- Remove `AddSession()`, `EndSession()`\n- Add `SetSession(ticketID, session)` - sets or replaces session\n- Add `ClearSession(ticketID)` - removes session (sets to nil)\n- Add `UpdateSession(ticketID, fn func(*Session))` - modify existing session\n\n## Files Affected\n\n- `~/projects/cortex1/internal/ticket/ticket.go` - schema\n- `~/projects/cortex1/internal/ticket/store.go` - methods\n- `~/projects/cortex1/internal/daemon/api/` - handlers and types\n- `~/projects/cortex1/internal/daemon/mcp/` - tools and types\n- `~/projects/cortex1/internal/cli/sdk/` - client types\n\n## Verification\n\n```bash\nmake test\nmake lint\n```\n\n## Implementation\n\n### Commits Pushed\n- `d13ef7a` refactor: change ticket-session schema from one-to-many to one-to-one\n\n### Key Files Changed\n- `internal/ticket/ticket.go` - Changed `Sessions []Session` to `Session *Session`, added `ClaudeSessionID` field, renamed `HasActiveSessions()` to `HasActiveSession()`\n- `internal/ticket/store.go` - Replaced `AddSession()` with `SetSession()`, simplified `EndSession()` and `UpdateSessionStatus()` to not require sessionID\n- `internal/daemon/api/types.go` - Updated response types for singular session\n- `internal/daemon/mcp/types.go` - Updated MCP output types for singular session\n- `internal/cli/sdk/client.go` - Updated SDK types and `FindSession()` method\n\n### Important Decisions\n- Simplified store methods: `SetSession(ticketID, agent, tmuxWindow, claudeSessionID)` replaces any existing session rather than having separate Add/Clear/Update methods\n- `EndSession(ticketID)` no longer needs sessionID since there's only one session\n- Removed backward compatibility code since this is a fresh project with no users\n\n### Scope Changes\n- Original plan included `ClearSession()` and `UpdateSession()` methods - simplified to just `SetSession()` and `EndSession()`\n- Did not implement backward-compatible JSON unmarshaling (removed per user feedback)",
  "dates": {
    "created": "2026-01-22T12:36:37Z",
    "updated": "2026-01-22T12:36:37Z",
    "done": "2026-01-22T12:36:37Z"
  },
  "comments": [],
  "session": null
}
