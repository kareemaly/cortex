{
  "id": "9fa94858-cc4f-43af-865d-aa183fbc0f6a",
  "title": "Prompt Templates",
  "body": "Add configurable prompt templates for architect and ticket agent sessions.\n\n## Requirements\n\n### Install prompts via `cortex install`\nCreate default prompt files:\n- `.cortex/prompts/architect.md`\n- `.cortex/prompts/ticket-agent.md`\n\n### Load prompts when spawning\n- `cortex architect` loads `.cortex/prompts/architect.md`\n- `spawnSession` loads `.cortex/prompts/ticket-agent.md`\n\n### Fail loudly if missing\nIf prompt files don't exist, fail with clear error asking user to run `cortex install`. No fallbacks or embedded defaults.\n\n### Template variables\n\n**Architect:**\n- `{{.ProjectName}}`\n- `{{.TmuxSession}}`\n\n**Ticket Agent:**\n- `{{.TicketID}}`\n- `{{.Title}}`\n- `{{.Body}}`\n- `{{.Slug}}`\n\n## Default Prompt Content\n\n### architect.md\n```markdown\nYou are the architect for project: {{.ProjectName}}\n\n## Role\nManage the ticket backlog and orchestrate development by spawning agent sessions.\n\n## Getting Started\nUse Cortex MCP `listTickets` with status filter to review:\n- `backlog` - tickets waiting to be worked on\n- `progress` - tickets with active agent sessions\n- `review` - tickets awaiting user review\n\n## Tools\n- Cortex MCP `listTickets` - list/search tickets (filter by status or query)\n- Cortex MCP `readTicket` - get full ticket details with sessions and comments\n- Cortex MCP `createTicket` - create new ticket in backlog\n- Cortex MCP `updateTicket` - update ticket title or body\n- Cortex MCP `deleteTicket` - delete a ticket\n- Cortex MCP `moveTicket` - move ticket between statuses\n- Cortex MCP `spawnSession` - spawn an agent to work on a ticket\n\n## Notes\n- Spawning a session does NOT move the ticket - the agent will call moveTicketToProgress\n- Read ticket comments to understand agent decisions and scope changes\n- Each ticket can have one active session at a time\n```\n\n### ticket-agent.md\n```markdown\nYou are working on ticket: {{.Title}}\n\n{{.Body}}\n\n## Workflow\n\n1. **Start**: Call Cortex MCP `moveTicketToProgress` to begin work\n   - Read the hook output for project-specific instructions\n\n2. **Work**: Explore, plan, and implement the solution\n   - Use Cortex MCP `addTicketComment` with type `decision` when making implementation choices\n   - Use Cortex MCP `addTicketComment` with type `scope_change` if requirements change\n   - Use Cortex MCP `addTicketComment` with type `blocker` if you get stuck\n   - Use Cortex MCP `addTicketComment` with type `question` to ask the user\n\n3. **Review**: When implementation is complete, call Cortex MCP `moveTicketToReview`\n   - Read the hook output for instructions (may run tests/lint)\n   - Wait for user feedback before proceeding\n\n4. **Complete**: After user approval, call Cortex MCP `moveTicketToDone`\n   - Read the hook output for instructions (may commit/push changes)\n\n5. **End**: Call Cortex MCP `concludeSession` to finish\n\n## Comment Types\n- `scope_change` - Requirement changed\n- `decision` - Implementation choice made\n- `blocker` - Stuck on something\n- `progress` - Status update\n- `question` - Asking the user\n- `general` - Other notes\n\n## Important\n- Always read hook output - it contains project-specific instructions\n- Do not skip steps - the workflow ensures proper tracking\n- Use comments liberally - they help the user understand your work\n```\n\n## Files Affected\n\n- `~/projects/cortex1/cmd/cortex/commands/install.go` - write prompt files\n- `~/projects/cortex1/cmd/cortex/commands/architect.go` - load architect.md\n- `~/projects/cortex1/internal/daemon/mcp/tools_architect.go` - load ticket-agent.md in spawnSession\n\n## Implementation\n\n### Commits Pushed\n- `b9044a6` feat: add configurable prompt templates for agent sessions\n\n### Key Files Changed\n- `internal/prompt/errors.go` - Custom error types (NotFoundError, ParseError, RenderError)\n- `internal/prompt/prompt.go` - Template loading logic with Go text/template\n- `internal/prompt/prompt_test.go` - Unit tests for prompt package\n- `internal/install/install.go` - Creates `.cortex/prompts/` with default templates\n- `cmd/cortex/commands/architect.go` - Loads architect.md template\n- `internal/daemon/mcp/tools_architect.go` - Loads ticket-agent.md in spawnSession\n- `internal/daemon/mcp/tools_test.go` - Updated test setup for prompt templates\n\n### Important Decisions\n- Created dedicated `internal/prompt/` package rather than adding to existing packages\n- Default templates stored as constants in prompt.go, written during `cortex install`\n- Templates loaded at runtime from files - no fallback to embedded defaults\n- Error messages include hint to run `cortex install --project`\n\n### Scope Changes\n- Used simpler default prompts than specified in ticket (basic versions that match the original hardcoded prompts)\n- Users can customize prompts by editing the generated files to add the richer content shown in ticket",
  "dates": {
    "created": "2026-01-22T11:42:52Z",
    "updated": "2026-01-22T11:42:52Z",
    "done": "2026-01-22T11:42:52Z"
  },
  "comments": [],
  "session": null
}
