{
  "id": "45b4ec7d-6925-48a9-b4cd-44cedcdfd628",
  "type": "research",
  "title": "Research cross-project ticketing for architects",
  "body": "## Research Question\n\nIs it feasible for architects to access, create, and spawn tickets across different projects from a single session?\n\n## Context\n\nCurrently, project context is scoped via:\n- `X-Cortex-Project` header (HTTP)\n- `CORTEX_PROJECT_PATH` env (MCP)\n\nArchitects are bound to one project at a time.\n\n## Areas to Investigate\n\n1. **Current Architecture Constraints**\n   - How is project context threaded through MCP tools?\n   - What would need to change in the daemon API?\n   - How does StoreManager handle multi-project access?\n\n2. **Use Cases**\n   - Spawning work in a dependency project\n   - Viewing tickets across a monorepo or related projects\n   - Coordinating work that spans multiple codebases\n\n3. **Design Options**\n   - Explicit project parameter on each tool call\n   - Project switching within architect session\n   - Global architect mode vs project-scoped architect\n\n4. **Security/Isolation Concerns**\n   - Should all projects be accessible or only registered ones?\n   - Permission model for cross-project operations\n\n## Deliverables\n\n- Summary of architectural implications\n- Recommended approach (if feasible)\n- List of files/components that would need modification",
  "dates": {
    "created": "2026-02-05T09:11:32.086772Z",
    "updated": "2026-02-05T09:31:29.83921Z",
    "progress": "2026-02-05T09:11:40.822503Z",
    "reviewed": "2026-02-05T09:15:15.142582Z",
    "done": "2026-02-05T09:31:29.83921Z"
  },
  "comments": [
    {
      "id": "85af31d6-e2f2-4594-b23c-ecd513e00f40",
      "session_id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
      "type": "comment",
      "content": "## Initial Architecture Analysis\n\n### Key Finding: Multi-Project Support Already Exists at Infrastructure Level\n\nThe architecture is well-positioned for cross-project access:\n\n1. **StoreManager** (`internal/daemon/api/store_manager.go`):\n   - Uses `map[string]*ticket.Store` keyed by absolute project path\n   - Already supports serving any project - just needs different path\n   - Thread-safe with RWMutex, lazy-loads stores on demand\n\n2. **HTTP API**:\n   - Project scoping via `X-Cortex-Project` header\n   - Handlers extract path and call `StoreManager.GetStore(projectPath)`\n   - No inherent single-project limitation\n\n3. **Constraint is at MCP Layer**:\n   - SDK client initialized once with single `projectPath` at session start\n   - All requests automatically use same header\n   - This is where cross-project would need changes\n\n### Feasibility: YES - with relatively modest changes\n\nThe daemon already supports multi-project. The limitation is only in how MCP sessions bind to a single project at initialization.",
      "created_at": "2026-02-05T09:13:28.07364Z"
    },
    {
      "id": "80f049c5-c898-46ff-80c2-87e6f06fd52d",
      "session_id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
      "type": "comment",
      "content": "## Design Options Summary\n\n**Recommended: Option A - Explicit Project Parameter**\n\nAdd optional `project_path` parameter to architect tools. Minimal change, backward compatible, clear intent.\n\n**Files to modify:**\n- `internal/cli/sdk/client.go` - Add `WithProject()` method\n- `internal/daemon/mcp/tools_architect.go` - Add param to tool schemas\n- `internal/daemon/api/projects.go` - Add validation endpoint\n\n**Security:** Only allow access to registered projects (validate against `~/.cortex/settings.yaml`).\n\nSee full plan file for implementation details.",
      "created_at": "2026-02-05T09:14:06.584867Z"
    },
    {
      "id": "90a5d664-f62b-4fa8-9e02-333d828973f3",
      "session_id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
      "type": "comment",
      "content": "## Research Conclusions\n\n**Feasibility: YES** - Cross-project ticketing is feasible with modest changes.\n\n### Key Decisions Made:\n1. **Approach**: Option A - Explicit `project_path` parameter on architect tools\n2. **Scope**: Full access (all tools except `deleteTicket`)\n3. **Security**: Registry-based validation only (projects in `~/.cortex/settings.yaml`)\n\n### Implementation Scope:\n- ~4 files to modify\n- SDK client: Add `WithProject()` method for per-request override\n- Architect tools: Add optional `project_path` param to tool schemas\n- Validation: Check target project is registered before cross-project ops\n\n### Architecture Insight:\nThe daemon infrastructure (StoreManager, HTTP API, Event Bus) already supports multi-project access. The constraint is purely at the MCP session layer where SDK client binds to single project at init time.\n\nFull details in plan file.",
      "created_at": "2026-02-05T09:15:04.221078Z"
    },
    {
      "id": "0b6724e5-cf8c-46c9-883e-803370833b35",
      "session_id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
      "type": "review_requested",
      "content": "## Research Complete: Cross-Project Ticketing for Architects\n\n### Research Question\nIs it feasible for architects to access, create, and spawn tickets across different projects from a single session?\n\n### Answer: YES - Feasible with modest changes\n\n---\n\n### Key Finding\nThe daemon infrastructure **already supports multi-project access**:\n- `StoreManager` uses `map[string]*ticket.Store` keyed by project path\n- HTTP API accepts any `X-Cortex-Project` header value\n- Event bus is keyed by project for proper isolation\n\nThe constraint is **only at the MCP layer** where SDK client binds to a single project at initialization.\n\n---\n\n### Recommended Approach: Explicit Project Parameter\n\nAdd optional `project_path` parameter to architect tools. If provided, override session default.\n\n**Files to modify:**\n1. `internal/cli/sdk/client.go` - Add `WithProject(path)` method\n2. `internal/daemon/mcp/tools_architect.go` - Add `project_path` param to schemas\n3. `internal/daemon/api/projects.go` - Add validation helper (optional)\n\n**Scope decisions:**\n- Full tool access (all except `deleteTicket`)\n- Security: Registry-based validation (only projects in `~/.cortex/settings.yaml`)\n\n---\n\n### Use Cases Enabled\n1. Architect in `frontend` creates ticket in `api` project\n2. View/manage tickets across monorepo packages\n3. Spawn work in dependency projects from current session\n\n---\n\n### Deliverables\n- [x] Summary of architectural implications\n- [x] Recommended approach (Option A - explicit project param)\n- [x] List of files/components to modify\n- [x] Security model (registry validation)\n- [x] Full plan file at `/Users/kareemelbahrawy/.claude/plans/humming-roaming-hedgehog.md`",
      "action": {
        "type": "git_diff",
        "args": {
          "repo_path": "/Users/kareemelbahrawy/projects/cortex1"
        }
      },
      "created_at": "2026-02-05T09:15:15.141464Z"
    },
    {
      "id": "8b4b5e1e-e81c-415e-8d7a-be30263ccb3f",
      "session_id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
      "type": "comment",
      "content": "## Gap Identified: Project Discovery\n\n**Problem**: Architects have no way to discover available projects.\n\n**Current state**:\n- SDK client has `ListProjects()` method (client.go:457)\n- HTTP endpoint exists: `GET /projects`\n- But NO architect MCP tool exposes this\n\n**Solution**: Add `listProjects` tool to architect tools\n\n```go\n// tools_architect.go\n{\n    Name: \"listProjects\",\n    Description: \"List all registered projects available for cross-project operations\",\n    // No input required\n}\n```\n\nThis tool should be added as part of the cross-project implementation.",
      "created_at": "2026-02-05T09:16:23.606424Z"
    },
    {
      "id": "34bef9a5-14d9-497c-8b73-55746b96ea01",
      "session_id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
      "type": "done",
      "content": "## Research Complete: Cross-Project Ticketing for Architects\n\n### Key Findings\n\n1. **Feasibility: YES** - Cross-project access is feasible with modest architectural changes.\n\n2. **Architecture Insight**: The daemon infrastructure (StoreManager, HTTP API, Event Bus) already supports multi-project access. The limitation is purely at the MCP session layer where the SDK client binds to a single project at initialization.\n\n3. **Current Constraint**: SDK client initialized once with `projectPath`, all requests use same `X-Cortex-Project` header.\n\n### Recommended Approach\n\n**Option A: Explicit Project Parameter**\n- Add optional `project_path` parameter to all architect tools\n- If omitted → uses session's default project (backward compatible)\n- If provided → uses specified project (cross-project operation)\n\n### Implementation Scope\n\n**Files to modify:**\n- `internal/cli/sdk/client.go` - Add `WithProject(path)` method for per-request override\n- `internal/daemon/mcp/tools_architect.go` - Add `project_path` param to tool schemas\n- `internal/daemon/mcp/tools_architect.go` - Add new `listProjects` tool for discovery\n\n**New tool required:**\n- `listProjects` - Allows architects to discover available projects (SDK method already exists)\n\n**Tool scope:**\n- Full access (all tools except `deleteTicket`)\n- Security: Registry-based validation (only projects in `~/.cortex/settings.yaml`)\n\n### Use Cases Enabled\n1. Architect in `frontend` creates/spawns tickets in `api` project\n2. View/manage tickets across monorepo packages\n3. Cross-codebase visibility and coordination\n\n### Artifacts\n- Plan file: `/Users/kareemelbahrawy/.claude/plans/humming-roaming-hedgehog.md`\n- Ticket comments documenting analysis progression\n\n### Next Steps (if implementing)\n1. Add `WithProject()` method to SDK client\n2. Add `listProjects` architect tool\n3. Add optional `project_path` param to all architect tool schemas\n4. Add validation against project registry\n5. Add integration tests for cross-project scenarios",
      "created_at": "2026-02-05T09:31:29.837716Z"
    }
  ],
  "session": {
    "id": "b3d56b35-6028-4138-8f73-3c39a3e1675e",
    "started_at": "2026-02-05T09:11:40.766253Z",
    "ended_at": "2026-02-05T09:31:29.838564Z",
    "agent": "claude",
    "tmux_window": "research-cross-project-ticketing-for-architects",
    "current_status": {
      "status": "idle",
      "tool": null,
      "work": null,
      "at": "2026-02-05T09:30:53.705614Z"
    },
    "status_history": [
      {
        "status": "starting",
        "tool": null,
        "work": null,
        "at": "2026-02-05T09:11:40.766253Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__readTicket",
        "work": null,
        "at": "2026-02-05T09:11:50.477741Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:03.794723Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:03.976021Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:04.111052Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:12:04.247275Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:05.608746Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:05.609452Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:05.609886Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:05.918472Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:07.894692Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:07.895145Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:08.067532Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:08.067924Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:08.068257Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:09.892303Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:10.259046Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:11.620355Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:11.627057Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:12:11.976438Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:12.523201Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:14.543314Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:14.544544Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:14.545666Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:15.636246Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:15.637257Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:16.513711Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:17.217809Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:17.516243Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:18.165766Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:12:18.74736Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:12:18.88054Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:20.062576Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:20.06349Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:20.493489Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:20.657032Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:12:20.906319Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:22.338826Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:12:22.482084Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:22.859657Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:22.860274Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:23.623532Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:23.842173Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:25.070519Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:25.135413Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:25.558753Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:27.055752Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:27.056702Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:27.225225Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:28.366515Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:28.894938Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:29.64549Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:30.227384Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:30.392063Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:31.438502Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:31.559559Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:33.099101Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:33.609859Z"
      },
      {
        "status": "in_progress",
        "tool": "Glob",
        "work": null,
        "at": "2026-02-05T09:12:34.97406Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:35.973165Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:36.216386Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:36.389474Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:38.145171Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:38.247956Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:38.248671Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:40.396355Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:42.277744Z"
      },
      {
        "status": "in_progress",
        "tool": "Bash",
        "work": null,
        "at": "2026-02-05T09:12:42.408578Z"
      },
      {
        "status": "in_progress",
        "tool": "Read",
        "work": null,
        "at": "2026-02-05T09:12:43.638391Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-02-05T09:12:54.225638Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-02-05T09:12:55.531703Z"
      },
      {
        "status": "in_progress",
        "tool": "Task",
        "work": null,
        "at": "2026-02-05T09:13:05.85459Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__addComment",
        "work": null,
        "at": "2026-02-05T09:13:28.093662Z"
      },
      {
        "status": "in_progress",
        "tool": "Write",
        "work": null,
        "at": "2026-02-05T09:13:59.799167Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__addComment",
        "work": null,
        "at": "2026-02-05T09:14:06.607807Z"
      },
      {
        "status": "waiting_permission",
        "tool": null,
        "work": null,
        "at": "2026-02-05T09:14:14.958339Z"
      },
      {
        "status": "in_progress",
        "tool": "AskUserQuestion",
        "work": null,
        "at": "2026-02-05T09:14:35.880171Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-05T09:14:44.276236Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-05T09:14:50.997166Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-05T09:14:56.733783Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__addComment",
        "work": null,
        "at": "2026-02-05T09:15:04.251171Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__requestReview",
        "work": null,
        "at": "2026-02-05T09:15:15.182573Z"
      },
      {
        "status": "idle",
        "tool": null,
        "work": null,
        "at": "2026-02-05T09:15:21.715177Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:16:16.354152Z"
      },
      {
        "status": "in_progress",
        "tool": "Grep",
        "work": null,
        "at": "2026-02-05T09:16:16.483318Z"
      },
      {
        "status": "in_progress",
        "tool": "mcp__cortex__addComment",
        "work": null,
        "at": "2026-02-05T09:16:23.637354Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-05T09:16:31.219004Z"
      },
      {
        "status": "idle",
        "tool": null,
        "work": null,
        "at": "2026-02-05T09:16:36.706772Z"
      },
      {
        "status": "in_progress",
        "tool": "Edit",
        "work": null,
        "at": "2026-02-05T09:30:50.285481Z"
      },
      {
        "status": "idle",
        "tool": null,
        "work": null,
        "at": "2026-02-05T09:30:53.705614Z"
      }
    ]
  }
}