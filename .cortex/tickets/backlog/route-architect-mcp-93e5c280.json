{
  "id": "93e5c280-bee0-49d5-9cba-d3098cc4f8a4",
  "title": "Route Architect MCP Reads Through Daemon HTTP API",
  "body": "## Problem\n\nThe architect MCP session has a hybrid data access pattern: mutations (create, update, delete, move) are routed through the daemon HTTP API via the SDK client, but reads (`listTickets`, `readTicket`) access the local ticket store directly. The `spawnSession` tool also reads the local store to look up ticket status before delegating to the HTTP API.\n\nThis breaks the \"everything talks to the daemon\" architecture. If the daemon runs on a remote VM, the architect MCP process wouldn't have access to the local ticket store files.\n\n### Current Flow\n```\nArchitect MCP reads  → local store (file system)\nArchitect MCP writes → SDK HTTP client → daemon API\n```\n\n### Expected Flow\n```\nArchitect MCP reads  → SDK HTTP client → daemon API\nArchitect MCP writes → SDK HTTP client → daemon API\n```\n\n## Context\n\nThe broader architectural goal is that `cortexd` is the single source of truth and all clients (CLI, TUI, MCP sessions) communicate with it exclusively over HTTP. This enables:\n- Running the daemon on a remote VM with agents and tmux\n- Running local client TUIs (`cortex dashboard`, `cortex kanban`) pointed at the remote daemon\n- Clean separation of concerns — no client needs direct file access\n\nCurrently all other clients (CLI, TUI, ticket MCP session) are already fully HTTP-routed. The architect MCP session is the only one with local store reads.\n\n## Scope\n\n### `internal/daemon/mcp/tools_architect.go`\n\n- **`handleListTickets`** — Replace `s.store.List(status)` with SDK client calls (`s.sdkClient.ListTicketsByStatus(status, query)` or `s.sdkClient.ListAllTickets(query)`)\n- **`handleReadTicket`** — Replace `s.store.Get(input.ID)` with `s.sdkClient.GetTicketByID(input.ID)` or `s.sdkClient.FindTicketByID(input.ID)`\n- **`handleSpawnSession`** — Replace `s.store.Get(input.TicketID)` (used to look up ticket status for URL path) with `s.sdkClient.GetTicketByID(input.TicketID)` and extract status from the response\n\n### `internal/daemon/mcp/server.go`\n\n- Remove the local `store` field from the MCP server struct if it's no longer needed after routing all reads through HTTP\n- Ensure `sdkClient` is always available for architect sessions\n\n### Response mapping\n\n- Map SDK client response types (`types.TicketResponse`, `types.TicketSummary`) to MCP output format\n- Existing `ToTicketOutput` and `ToTicketSummary` helpers may need to be adapted to work with HTTP response types instead of local store types\n\n## Acceptance Criteria\n\n- [ ] `listTickets` routes through daemon HTTP API (no local store access)\n- [ ] `readTicket` routes through daemon HTTP API (no local store access)\n- [ ] `spawnSession` status lookup routes through daemon HTTP API\n- [ ] Architect MCP server no longer requires a local `ticket.Store` reference\n- [ ] All existing MCP tests pass (update test setup to use HTTP test server)\n- [ ] `make build \u0026\u0026 make test` pass",
  "dates": {
    "created": "2026-01-27T11:27:28.249661Z",
    "updated": "2026-01-27T11:27:28.249661Z"
  },
  "comments": []
}